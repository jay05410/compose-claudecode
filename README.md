# Compose ClaudeCode

**Multi-model agent orchestration for Claude Code with intelligent configuration and workflow management.**

## Quick Start

```bash
# 1. Install plugin
/plugin install compose-claudecode

# 2. (Optional) Setup MCP servers globally - ONE TIME for ALL projects
npx ecc mcp-setup

# 3. Initialize for your project
/setup

# 4. Start building
# Example: "Add user authentication"
# Example: "Create a dashboard page"
```

That's it! The `/setup` command will interview you about your project and automatically configure everything.

**MCP Setup** (`npx ecc mcp-setup`):
- Configure once, use in ALL projects
- Just paste your API keys
- Automatically updates `~/.claude.json`
- No manual JSON editing needed!

---

## Features

- **üéØ Smart Initialization**: `/setup` command configures your project automatically
- **ü§ñ 24 Specialized Agents**: Optimal model assignments (40% token savings)
- **‚ö° Two Modes**: Auto (flexible) or Structured (predefined workflows)
- **üìä Multi-Model**: Opus 4.5, Gemini 3, GLM-4.7, GPT-5.2
- **üí∞ Cost Optimized**: Intelligent model selection saves tokens
- **üîß Reconfigurable**: Change settings anytime with `/setup`

---

## Configuration

All configuration happens in **two files**:

1. **`CLAUDE.md`** (your project) - Generated by `/setup`
   - Your tech stack
   - Workflow preferences
   - Custom rules

2. **`config/stack.yaml`** (your project) - Auto-configured
   - Model assignments
   - Stack versions

**Do not modify this plugin's `README.md`** - it's just documentation.
**Do modify your project's `CLAUDE.md`** - it's your configuration.

---

## MCP Setup (One-Time, Optional)

**Note:** MCP is optional. This plugin works with Claude's built-in models (Opus, Sonnet, Haiku) without MCP configuration.

### Automated Setup (Recommended) üöÄ

**One command, works for ALL projects:**

```bash
npx ecc mcp-setup
```

This interactive command will:
1. Ask which MCP servers you want (Gemini, OpenAI, GLM)
2. Guide you to get API keys
3. Automatically update `~/.claude.json` (global config)
4. Available in **all projects** immediately after restart

**Benefits:**
- ‚úÖ Configure once, use everywhere
- ‚úÖ No manual JSON editing
- ‚úÖ Automatic backup before changes
- ‚úÖ Secure (API keys hidden during input)

### Manual Setup (Alternative)

If you prefer manual configuration:

#### 1. Get API Keys First

- **Gemini** (Free): [aistudio.google.com/apikey](https://aistudio.google.com/apikey) - 60 req/min, 1,500/day
- **OpenAI** (Paid): [platform.openai.com/api-keys](https://platform.openai.com/api-keys) - GPT-4o, o1, o3
- **GLM** (Paid): [open.bigmodel.cn](https://open.bigmodel.cn/) - 30% cheaper

#### 2. Choose Your Setup Method

##### Method A: Using Commands (Quick)

Run these commands and replace with your actual API keys:

```bash
# Add Gemini
claude mcp add gemini --command "npx" --args "-y" --args "github:aliargun/mcp-server-gemini" -e GEMINI_API_KEY="your-gemini-key-here"

# Add OpenAI (optional)
claude mcp add openai --command "npx" --args "-y" --args "@mzxrai/mcp-openai@latest" -e OPENAI_API_KEY="your-openai-key-here"

# Add GLM (optional)
claude mcp add glm --command "npx" --args "-y" --args "@zhipuai/mcp-server" -e ZHIPUAI_API_KEY="your-glm-key-here"

# Verify
claude mcp list
```

#### Method B: Manual Configuration

Edit `~/.claude.json` and add the `mcpServers` section:

```json
{
  "mcpServers": {
    "gemini": {
      "command": "npx",
      "args": ["-y", "github:aliargun/mcp-server-gemini"],
      "env": {
        "GEMINI_API_KEY": "your-gemini-key-here"
      }
    },
    "openai": {
      "command": "npx",
      "args": ["-y", "@mzxrai/mcp-openai@latest"],
      "env": {
        "OPENAI_API_KEY": "your-openai-key-here"
      }
    }
  }
}
```

**Important:** If `~/.claude.json` already has content, merge the `"mcpServers"` section into your existing file.

#### Method C: Environment Variables (Most Secure)

1. Add to `~/.zshrc` or `~/.bashrc`:
   ```bash
   export GEMINI_API_KEY="your-gemini-key"
   export OPENAI_API_KEY="your-openai-key"
   export ZHIPUAI_API_KEY="your-glm-key"
   ```

2. Reload shell: `source ~/.zshrc`

3. Add MCP servers without hardcoding keys:
   ```bash
   claude mcp add gemini --command "npx" --args "-y" --args "github:aliargun/mcp-server-gemini"
   claude mcp add openai --command "npx" --args "-y" --args "@mzxrai/mcp-openai@latest"
   ```

### 3. Verify

```bash
claude mcp list
# Should show: gemini ‚úì Connected (and others if added)

---

## How It Works

```
User Request
     ‚Üì
Orchestrator analyzes
     ‚Üì
‚îú‚îÄ Auto Mode: Creates plan on-the-fly
‚îî‚îÄ Structured Mode: Uses predefined workflow
     ‚Üì
Agents execute (with optimal models)
     ‚Üì
Checkpoints for review
     ‚Üì
Done!
```

---

## Usage

### Automatic Execution

Everything runs automatically. Just make a request and the system handles it:

```
You: "Add user authentication"

System:
‚úì Analyzing request...
‚úì Starting PM agent (progress tracking)
‚úì Using feature-development workflow (4 phases, est. $3-8)
‚úì Phase 1: Planning (2 min)
‚úì Phase 2: Backend (5 min)
‚úì Phase 3: Frontend (4 min)
‚úì Phase 4: Testing (3 min)
‚úÖ Complete! See .plans/WORK_LOG.md for details
```

The system only stops for **critical decisions** (architecture choices, security issues, destructive operations).

### Manual Commands

| Command | Description |
|---------|-------------|
| `/setup` | Initialize or reconfigure project |
| `/status` | Check current progress with visual charts |
| `/plan` | View current project plan |
| `/log` | See work history |
| `/stop` | Halt automatic execution |
| `/help` | Context-aware help |
| **Agent Invocation** | |
| `/frontend-engineer` | Invoke specific agent manually |
| `/backend-engineer` | Invoke backend agent |
| `/architect` | Invoke architect for design |
| _(any agent name)_ | Call any of the 24 agents directly |
| **Workflow Invocation** | |
| `/feature-development` | Use feature development workflow |
| `/code-review` | Use code review workflow |

### Progress Tracking

The PM agent automatically creates documentation:
- `.plans/PROJECT_PLAN.md` - Project timeline with Mermaid charts
- `.plans/WORK_LOG.md` - Detailed work history
- `.plans/features/` - Per-feature progress tracking

---

## Example Session

```
You: /setup

Atlas: Let's configure your project!

What's your stack?
- Language: TypeScript 5.3
- Frontend: Next.js 14
- Backend: Node.js (Next.js API routes)
- Database: PostgreSQL

Complexity? Medium
Team? Solo
Skill level? Intermediate

‚öôÔ∏è Optimizing...

‚úÖ Done! Created:
- CLAUDE.md (your project config)
- stack.yaml (optimized models)

Ready! Try: "Add user authentication"
```

---

## Learn More

- See `CLAUDE.md` (this plugin's documentation) for full architecture details
- See your project's `CLAUDE.md` (generated by `/setup`) for your configuration
- Run `/help` for context-aware assistance

---

## Inspired By

This project draws inspiration from:
- [oh-my-opencode](https://github.com/moqimoqidea/oh-my-opencode)
- [everything-claude-code](https://github.com/affaan-m/everything-claude-code)

---

## License

MIT
